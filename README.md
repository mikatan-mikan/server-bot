# server-bot

## 用途

mc serverをdiscord上から操作する用途。

プログラムに含まれるコマンドは以下の通りです。

|コマンド|実行結果|
|----|----|
|help|discord上にhelpを表示します。 |
|ip|このbot(サーバー)を実行しているipアドレスを返します。|
|start|サーバーを開始します。但し、server.py起動時には自動的に開始されます。このコマンドの実行には管理者権限が必要です。|
|stop|サーバーを停止します。但しserver.pyは実行状態から遷移しないため他のコマンドを使用できます。このコマンドの実行には管理者権限が必要です。|
|exit|server.pyを終了します。サーバー停止中にのみ使用できます。このコマンドの実行には管理者権限が必要です。|
|backup|サーバーデータをバックアップします。引数が与えられない場合`./worlds`をバックアップします。このコマンドの実行には管理者権限が必要です。|
|cmd|マインクラフトサーバーに対してコマンドを送信します。このコマンドの実行には管理者権限が必要です。|
|replace|server.pyを与えられた引数に置換します。このコマンドの実行には管理者権限が必要です。|

これらコマンドの設定等は後述の使用方法を参照してください。

## 動作確認

統合版 dedicated server にて動作確認をしています。

java版でも恐らく使えるはず。。。

恐らくという意味ではこのbotは/stopの際に標準入力にstopを入力していますが、その点を変更すれば他のゲームサーバ等でも利用できるはずです。。。

### 確認済み環境

os : windows 11 version 23H2

lang : python3.12.2

## 必要なもの

現在使用していないdiscord bot

### ライブラリ

requirements.txtを参照

## 使用方法

server.pyを任意の場所に配置します。(推奨ディレクトリは実行するserver.[exe/jar]が存在する階層です。)

ただしserver.exeやserver.jar本体が存在する階層はrootでない必要があります。(何かのディレクトリの中に入れてください)これは、`../backup/`内にbackupが生成されるためです。

後にserver.pyを起動すると`./.token`と`./.config`が生成されます。

./.tokenにbotのtokenを記述してください。

./.configについては後述します。

このとき同時に`update.py`が生成されますが、これは`/repalce`を実行するために必要なファイルです。

token記述後にカレントディレクトリとserver.py/server.[exe/jar]が存在する階層が同じ状態で再度server.pyを起動すると正常に起動するはずです。このプログラムはserver.pyがサーバー本体を呼び出すためserver.[exe/jar]を自身で起動する必要はありません。

### .config

./configは初期生成では以下のような内容で構成されています。

```json
{
    "allow": {
        "ip": true
    },
    "server_path": str(path of server.py),
    "allow_mccmd": [
        "list",
        "whitelist",
        "tellraw",
        "w",
        "tell"
    ],
    "server_name": "bedrock_server.exe"
}
```

|項目|説明|
|---|---|
|allow|各コマンドの実行を許可するかどうか。(現在は/ipにのみ実装されています)|
|server_path|minecraft server本体のパス(例えば`D:\\a\\server.jar`に配置されていれば`D:\\a\\`)|
|allow_mccmd|/cmdで実況を許可するmcコマンドのリスト|
|server_name|minecraft server本体の名前|

ただし、server_pathがserver.pyの存在するディレクトリと一致しない場合(server.[exe/jar]とserver.pyの階層が違う場合)にも/replaceを行うと新たなファイル群はserver.py下に生成されます。

従ってserver.pyはサーバ本体と同じ改装に配置することを推奨します。

## 注意

~~このbotは見知らぬプレイヤーが多くいる状況下での使用を推奨していません。もしもそのような状況下で利用したい場合にはほとんどのコマンドに管理者権限のチェックを実装する必要があるでしょう。(但し誰でもコマンドを実行できる環境は後に改善する予定があります。)~~

2024/06/05 ほとんどのコマンドにおいて実行するdiscordサーバーの管理者権限が必要になりました。

またserver.pyと生成されるupdate.pyの名前は変更しないでください。`/replace`が動作しなくなるはずです。

### /cmd

このコマンドで利用できるコマンドは`allow_cmd`により定義されています。他に使いたいコマンドが存在する場合はlistを追加してください。

コマンド使用例としてwhitelistへの追加は/cmd `command:whitelist add <mcid>`のようにして実行できます。

### /exit

このコマンドを実行すると次回サーバー管理者がserver.pyを実行するまで他のコマンドを使用できません。

## 免責事項

本プログラムのインストール/実行/その他本プログラムが影響する挙動全てにおいて、生じた損害や不具合には作者は一切の責任を負わないものとします。
